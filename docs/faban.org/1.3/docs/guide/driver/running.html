<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from faban.org/1.3/docs/guide/driver/running.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 22 Jul 2015 09:04:06 GMT -->
<head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Making Benchmark Runs</title>

<meta content="AKARA SUCHARITAKUL" name="author">
<link href="../../css/default.css" rel="stylesheet" type="text/css">
</head>
<body>
<a accesskey="p" href="recording.html" title="Previous"><img alt="Previous" src="../../img/previous.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a acccesskey="c" href="../../toc.html#Faban_Driver_Framework_Developers_Guide_" title="Beginning"><img alt="Beginning" src="../../img/up.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a accesskey="n" href="sampledriver.html" title="Next"><img alt="Next" src="../../img/next.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><br>
<br>
<h1>Making Benchmark Runs</h1>
<p class="Textbody">First we need to have an understanding
of the input,
processing, and output of the benchmark run. When a benchmark gets
started, the driver framework reads the benchmark configuration file
and merges the configuration information with the
annotations in the driver. Then it starts the load as specified by the
drivers. At the end of the run, the driver framework will create result
files in the output directory as specified in the
configuration file.&nbsp;</p>
<h2><a name="Driver_Configuration_File"></a>Benchmark
Configuration File</h2>
<p class="Textbody">The
driver configuration file acts as the glue betweenFaban
and the benchmarks. It is an xml file which may contain any number of
sections defining configurations of other components, even the
benchmark application. The driver framework requires the presence
of a runConfig section and <span class="T11">one
driverConfig</span> section for each driver. Faban
specifies the structure of this section. The driver framework usually
skips all other sections which may be used by the driver class itself,
the Faban harness, the benchmark class, and other components of the
benchmark. Appendix C lists a sample driver configuration file
consisting of only the driverConfig section.</p>
<h2><a name="Driver_Output_Files"></a>Benchmark
Output
Files</h2>
<p class="Textbody">At the end of a completed run, the
master outputs one or more summary files and a detail file, as follows:<br>
&nbsp;</p>
<h3><a name="Summary_File"></a>Summary File</h3>
<p class="Textbody">For a single driver rig, Faban only
outputs one grand summary called <span style="font-family: monospace;">summary.xml</span>.
For larger rigs with 2 or more driver systems, Faban automatically
generates the per-driver system summary file in addition to the grand
summary. The per-driver summary is named <span style="font-family: monospace;">summary.xml.&lt;hostname&gt;</span>.
This can give us an indication how much of the load was generated by
each of the driver systems, and also helps us detect driver-side
anomalies such as a bad network interface on one of the driver systems.</p>
<p class="Textbody">The summary file is in xml format with
a concrete schema. It contains a header
section that describes the aggregated results, and has sections showing
results for each driver. This file can be
translated into other more readable formats. The driver provides a
style sheet named <span style="font-family: monospace;">summary_report.xsl</span>
to translate the summary to readable html format. <a href="samplesummary.html">Appendix D</a> shows an
example summary file and a HTML translation of the summary file.<br>
</p>
<h3><a name="Detail_File"></a>Detail File</h3>
<p class="Textbody">For a single driver rig, Faban outputs
one&nbsp;detail file named <span style="font-family: monospace;">detail.xan</span>.
For larger rigs with 2 or more driver systems, Faban automatically
generates the per-driver system detail file in addition to the grand
summary. The per-driver detail is named <span style="font-family: monospace;">detail.xan.&lt;hostname&gt;</span>.
The detail files are in human-readable&nbsp;text
format compatible with FenXi, the postprocessing tool integrated with
Faban. The detail files contain the
information representing the throughput over time, response time over
time, and histograms representing the distribution of
response times and cycle or think times of each driver and operation
collected from the run and each driver system.<br>
</p>
<h2><a name="Running_The_Driver"></a>Deploying
the Benchmark</h2>
<p class="Textbody">The preferred way to run a benchmark
is to deploy it in the harness. The harness will be able to manage
dependencies and ensure that all needed classes are available to all
applicable systems in the rig. In addition, the harness can take care
of configuring the rig, starting/restarting server processes, load
data, post-processing, and others.</p>
<p class="Textbody">To deploy the benchmark in the
harness, you may need 3 additional components:</p>
<ol>
<li>The benchmark descriptor - <span style="font-family: monospace;">benchmark.xml</span><br>
This file is needed for any non-standard deployment or if any
deployment parameters are needed. Otherwise it is optional.</li>
<li>A configuration form<br>
By default, this is named <span style="font-family: monospace;">config.xhtml</span>.
Faban will auto-generate the form if it does not exist. Alternatively,
you can use the <span style="font-family: monospace;">genxform</span>
ant task to generate a form from your configuration file and edit it as
you prefer.</li>
<li>The benchmark class<br>
If you have any custom rig setup/configuration or post-processing, you
will want to subclass <span style="font-family: monospace;">DefaultFabanBenchmark2</span>
and define those in methods annotated by <span style="font-family: monospace;">@Configure</span> and <span style="font-family: monospace;">@PostRun</span>.</li>
</ol>
<p class="Textbody">Details for benchmark deployment is
discussed in the <a href="http://faban.org/1.0/docs/guide/harnessdev/overview.html">Faban
Harness Developers
Guide</a> and the <a href="http://www.testnscale.com/docs/QuickStartTutorial.html">tutorials</a>.<br>
</p>
<h2>Testing the Benchmark</h2>
<p class="Textbody">The remainder of this secion discusses
how you would go about running the benchmark by hand, mainly for
testing and debuging.</p>
<p class="Textbody">A
Faban driver can be run in two modes: The restricted single-process
mode and the full fledged distributed mode. The single-process mode
is very useful when testing drivers. It provides for a simple
environment to run the driver from a script and debug the driver in
your IDE. The distributed driver is
more suitable for testing full-fledged benchmarks, the same way the
benchmark would be run in the harness. The commands and sequences to
run in distributed mode are more complicated and make scripting more
difficult as &#8211; generally &#8211;
they will need to be executed on many machines. Most developers do not
need to test in this mode and the harness is clearly the suggested way
for running distributed drivers.<br>
</p>
<h3><a name="Running_The_Single-Process_Driver"></a>Running
The Single-Process Driver</h3>
<p class="Textbody">Running the single process driver is
simple. We
just need to edit the configuration file and execute the following
command:</p>
<pre> java -cp &lt;path&gt;/fabandriver.jar:&lt;myclasspath&gt; -Dbenchmark.config=&lt;config_file_path&gt;<br> <a href="http://faban.org/1.0/docs/api/com/sun/faban/driver/engine/MasterImpl.html">com.sun.faban.driver.engine.MasterImpl</a><br></pre>
<p>Alternatively, you can use the run task from the ant build
file <span style="font-family: monospace;">build.xml</span>
or run <span style="font-family: monospace;">sbin/master.sh</span>
in all the samples to start the driver.<br>
</p>
<h3><a name="Running_The_Distributed_Driver"></a>Running
The Distributed Driver</h3>
<p class="Textbody">Starting
the distributed driver involves starting all three components of the
Faban driver framework in order. First we need to start the registry.
The registry registers the agents as they come up. Then we need to
start all the agents on all the driver machines. Once all the agents
are successfully started, the master will need to be started. The
master's job is to read the configuration, coordinate the start of the
whole benchmark, and &nbsp;collect the metrices after the benchmark
run
has
ended.</p>
<p class="Textbody">We do need special security policies
to
run the distributed driver. Since we are not concerned about security
in a benchmark environment, we can have a very broad &#8220;allow-all&#8221; type
of security policy in the policy file as follows:</p>
<pre> grant {<br> permission java.security.AllPermission<br> }<br></pre>
<p class="Textbody">The following command starts the
registry.&nbsp;</p>
<pre> java -cp &lt;path&gt;/fabandriver.jar -Djava.security.policy=&lt;policy_file_path&gt;<br> <a href="http://faban.org/1.0/docs/api/com/sun/faban/common/RegistryImpl.html">com.sun.faban.common.RegistryImpl</a></pre>
<p class="Textbody">Alternatively, you can use the
registry task from the ant build
file <span style="font-family: monospace;">build.xml</span>
or run <span style="font-family: monospace;">sbin/registry.sh</span>
in the samples to start the driver.</p>
<p class="Textbody">Next we start all the agents. Note
that the <span class="T11">&lt;driver_name&gt;</span>
represents the annotated driver
name, not the driver class name. The <span class="T11">&lt;agent_id&gt;</span>
is a unique numeric id for each agent running the same driver, starting
with 1.</p>
<pre> java -cp &lt;path&gt;/fabandriver.jar:&lt;myclasspath&gt; -Djava.security.policy=&lt;policy_file_path&gt;<br> <a href="http://faban.org/1.0/docs/api/com/sun/faban/driver/engine/AgentImpl.html">com.sun.faban.driver.engine.AgentImpl</a> &lt;driver_name&gt; &lt;agent_id&gt; &lt;master_host_name&gt;</pre>
<p class="Textbody">Alternatively, you can use the agent
task from the ant build
file <span style="font-family: monospace;">build.xml</span>
or run <span style="font-family: monospace;">sbin/agent.sh</span>
in the samples to start the driver.</p>
<p class="Textbody">After
all the agents are up, we then
start the
master with this command. The master is just started like the
single-process driver, with a few additional but necessary arguments.</p>
<pre> java -cp &lt;path&gt;/fabandriver.jar:&lt;myclasspath&gt; -Djava.security.policy=&lt;policy_file_path&gt;<br> -Dbenchmark.config=&lt;config_file_path&gt; <a href="http://faban.org/1.0/docs/api/com/sun/faban/driver/engine/MasterImpl.html">com.sun.faban.driver.engine.MasterImpl</a></pre>
<p class="Textbody">Alternatively, you can use the run
task from the ant build
file <span style="font-family: monospace;">build.xml</span>
or run <span style="font-family: monospace;">sbin/master.sh</span>
in all the samples to start the driver.</p>
<p class="Textbody">These
represent the minimum needed to start the Faban driver
framework processes. For proper tuning and configurations, the next
section will discuss the common JVM tuning and &nbsp;system
properties
used
for running the driver framework.</p>
<h2><a name="Properties_and_Java_Parameters"></a>Properties
and Java Parameters</h2>
<p class="Textbody">All
properties are passed to Faban using the Java standard -D command line
argument. There must be no space between the -D and the property name,
i.e. <span class="T11">-Djava.util.logging.config.file=myLogConfig.properties</span>.
The way java parameters are passed to the JVM depends on the specific
parameter and will be discussed separately for each specific option
below:<br>
<br>
</p>
<p class="Textbody">
<big><span style="font-family: monospace;">java.util.logging.config.file</span></big>&nbsp;
</p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
All
Faban Driver Framework processes.&nbsp;</p>
<p class="Textbody">Faban
utilizes the java logging APIs and therefore allow explicit logging
configuration utilizing the standard java logging API standard. The
property is needed to set the log level for each package and the log
target. If the Faban Harness is used, this will be set
automatically.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">java.security.policy&nbsp;</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
All
Faban Driver processes, distributed mode
only.</p>
<p class="Textbody">This
is a mandatory property for the distributed driver. Without this
property and a proper security policy file (discussed above), the
distributed driver will seize to function.<br>
<br>
</p>
<big>
<p class="Textbody"><big><span style="font-family: monospace;">benchmark.config</span></big></p>
</big>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
Master or single-process driver.</p>
<p class="Textbody">This
is a mandatory property for the master or single-process driver. It
points the master to the benchmark config file and uses this config
file to configure and read the developer-implemented driver.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">faban.outputdir.unique</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
Master or single-process driver.</p>
<p class="Textbody">This
property tells the master not to generate it's own run identifier. It
is generally used by Harnesses telling the Faban Driver framework to
target the run output to a certain directory instead of creating a
sub-directory. The name of the directory isuse as the run
identifier.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">faban.registry.port</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
All
processes, distributed mode only.</p>
<p class="Textbody">This
property overrides the default registry port 9998 to use a different
port. This property is used to avoid conflict between multiple Faban
Driver framework instances installed in the same network.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">faban.ssl.autotiming</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
All Faban Driver processes, when driving ssl traffic over the Apache
HttpClient 3.1 transport provider.</p>
<p class="Textbody">Attaches the socket auto-timer above
or below the ssl stack.
The two
options are "<span style="font-weight: bold;">above</span>"
and "<span style="font-weight: bold;">below</span>."
The default is attaching the auto-timer above the ssl stack. Attaching
it below excludes the client-side cryptographic processing from the
reported times.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">faban.xsl.path</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
Master or single-process driver.&nbsp;</p>
<p class="Textbody">This
property specifies the stylesheet paths to use for displaying results.
It defaults to the harness' xsl path which is a relative path <span style="font-family: monospace;" class="T11">../../xslt</span>.<br>
<br>
</p>
<p class="Textbody"><big><span style="font-family: monospace;">DisableExplicitGC</span></big></p>
<p class="Textbody"><span style="font-weight: bold;">Scope:</span>
All
processes, distributed mode only.&nbsp;</p>
<p class="Textbody">This option is
recommended for all drivers running in distributed mode. This
is a JVM option, not a property. It disables the regular garbage
collection calls and avoid long pauses in the driver.&nbsp; To use
this
option, specify <span style="font-family: monospace;">-XX:+DisableExplicitGC</span>
in the java command line. <br>
</p>
<a accesskey="p" href="recording.html" title="Previous"><img alt="Previous" src="../../img/previous.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a acccesskey="c" href="../../toc.html#Faban_Driver_Framework_Developers_Guide_" title="Beginning"><img alt="Beginning" src="../../img/up.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a accesskey="n" href="sampledriver.html" title="Next"><img alt="Next" src="../../img/next.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><br>
<br>
</body>
<!-- Mirrored from faban.org/1.3/docs/guide/driver/running.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 22 Jul 2015 09:04:06 GMT -->
</html>