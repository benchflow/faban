<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Mirrored from faban.org/1.3/docs/guide/driver/sampledriver.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 22 Jul 2015 09:04:06 GMT -->
<head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Appendix A: Sample Benchmark Driver</title>

<meta content="AKARA SUCHARITAKUL" name="author">
<link href="../../css/default.css" rel="stylesheet" type="text/css">
</head>
<body>
<a accesskey="p" href="running.html" title="Previous"><img alt="Previous" src="../../img/previous.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a acccesskey="c" href="../../toc.html#Faban_Driver_Framework_Developers_Guide_" title="Beginning"><img alt="Beginning" src="../../img/up.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a accesskey="n" href="sampleconfig.html" title="Next"><img alt="Next" src="../../img/next.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><br>
<h1>Appendix A: Sample Benchmark Driver</h1>
<table style="text-align: left; background-color: rgb(204, 204, 204); width: 100%;" border="1" cellpadding="2" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="color: black;"><big>package sample.driver;<br><br>import com.sun.faban.driver.*;<br>import com.sun.faban.driver.util.Random;<br>import com.sun.faban.driver.util.ContentSizeStats;<br><br>import javax.xml.xpath.XPathExpressionException;<br>import java.io.IOException;<br>import java.util.logging.Logger;<br><br>@BenchmarkDefinition (<br>    name    = "Sample Web Workload 101",<br>    version = "0.2"<br>)<br>@BenchmarkDriver (<br>    name           = "WebDriver",<br>    threadPerScale    = 1<br>)<br>@MatrixMix (<br>    operations = {"MyOperation1", "MyOperation2", "MyOperation3"},<br>    mix = { @Row({  0, 70, 30 }),<br>            @Row({ 60,  0, 40 }),<br>            @Row({ 50, 50,  0 }) },<br>    deviation = 2<br>)<br>@NegativeExponential (<br>    cycleType = CycleType.CYCLETIME,<br>    cycleMean = 5000,<br>    cycleDeviation = 2<br>)<br>public class WebDriver {<br><br>    /** The driver context for this instance */<br>    private DriverContext ctx;<br>    private HttpTransport http;<br>    private String url1, url2, url3;<br>    Logger logger;<br>    Random random;<br>    ContentSizeStats contentStats = null;<br><br>    public WebDriver() throws XPathExpressionException {<br>        ctx = DriverContext.getContext();<br>        http = HttpTransport.newInstance();<br>        logger = ctx.getLogger();<br>        random = ctx.getRandom();<br>        String host = ctx.getXPathValue("/webBenchmark/serverConfig/host");<br>        String port = ctx.getXPathValue("/webBenchmark/serverConfig/port");<br>        //String dbhost = ctx.getXPathValue("/webBenchmark/dbServer/fa:hostConfig/fa:host");<br>        String path1 = ctx.getProperty("path1");<br>        String path2 = ctx.getProperty("path2");<br>        String path3 = ctx.getProperty("path3");<br>        url1 = "http://" + host + ':' + port + '/' + path1;<br>        url2 = "http://" + host + ':' + port + '/' + path2;<br>        url3 = "http://" + host + ':' + port + '/' + path3;<br>        contentStats = new ContentSizeStats(ctx.getOperationCount());<br>        ctx.attachMetrics(contentStats);<br>    }<br><br>    @OnceBefore public void testPreRun() {<br>        try {<br>            Thread.sleep(5000);<br>        } catch (InterruptedException e) {<br>        }<br>        logger.info("Tested pre-run (sleep 5) done");<br>    }<br><br>    @OnceAfter public void testPostRun() {<br>        try {<br>            Thread.sleep(5000);<br>        } catch (InterruptedException e) {<br>        }<br>        logger.info("Tested post-run (sleep 5) done");<br>    }<br><br>    @BenchmarkOperation (<br>        name    = "MyOperation1",<br>        max90th = 2,<br>        timing  = Timing.AUTO<br>    )<br>    public void doMyOperation1() throws IOException {<br>        logger.finest("Accessing " + url1);<br>        http.fetchURL(url1);<br>        if (ctx.isTxSteadyState())<br>            contentStats.sumContentSize[ctx.getOperationId()] +=<br>                                                        http.getContentSize();<br>    }<br><br>    @BenchmarkOperation (<br>        name    = "MyOperation2",<br>        max90th = 2,<br>        timing  = Timing.AUTO<br>    )<br>    public void doMyOperation2() throws IOException {<br>        logger.finest("Accessing " + url2);<br>        http.fetchURL(url2);<br>        if (ctx.isTxSteadyState())<br>            contentStats.sumContentSize[ctx.getOperationId()] +=<br>                                                        http.getContentSize();<br>    }<br><br>    @BenchmarkOperation (<br>        name    = "MyOperation3",<br>        max90th = 2,<br>        timing  = Timing.AUTO<br>    )<br>    public void doMyOperation3() throws IOException {<br>        logger.finest("Accessing " + url3);<br>        http.fetchURL(url3);<br>        if (ctx.isTxSteadyState())<br>            contentStats.sumContentSize[ctx.getOperationId()] +=<br>                                                        http.getContentSize();<br>    }<br>}</big></pre><big><big>
</big></big></td>
</tr>
</tbody>
</table>
<!-- object
data="/source/browse/faban/workspace/samples/benchmarks/web101/src/sample/driver/WebDriver.java?revision=1.1"
type="text/plain" height="540" width="100%">
</object --><a accesskey="p" href="running.html" title="Previous"><img alt="Previous" src="../../img/previous.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a acccesskey="c" href="../../toc.html#Faban_Driver_Framework_Developers_Guide_" title="Beginning"><img alt="Beginning" src="../../img/up.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><a accesskey="n" href="sampleconfig.html" title="Next"><img alt="Next" src="../../img/next.gif" style="border: 0px solid ; width: 40px; height: 40px;"></a><br>
<br>
</body>
<!-- Mirrored from faban.org/1.3/docs/guide/driver/sampledriver.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 22 Jul 2015 09:04:06 GMT -->
</html>
